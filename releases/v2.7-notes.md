# V2.7 – Nouveau projet Supabase

Cette version utilise le nouveau projet Supabase après la suppression de l'ancien.

## Nouveautés / Changements

- **Nouveau projet Supabase** : `nulrmprnorszvsdenxqa`
- **Configuration mise à jour** : URL et clés d'API Supabase
- **Migration requise** : Table `fcm_tokens` pour les notifications
- **Même fonctionnalités** : Notifications push, Google Maps, interface admin

## Fichier APK

- **Nom** : `vtc-dispatch-v2.7.apk`
- **Type** : Debug (non signé)
- **Package** : `com.vtcdispatch.app`
- **Taille** : ~5.3 MB
- **Configuration** : Nouveau projet Supabase

## Migration base de données REQUISE

⚠️ **IMPORTANT** : Vous devez appliquer la migration SQL avant d'utiliser l'app.

### Étapes :

1. **Allez sur** : https://supabase.com/dashboard/project/nulrmprnorszvsdenxqa/sql/new
2. **Copiez-collez ce SQL** :

```sql
-- Créer la table fcm_tokens pour les notifications
CREATE TABLE IF NOT EXISTS public.fcm_tokens (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
    token TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
    UNIQUE(user_id)
);

-- Index et permissions
CREATE INDEX IF NOT EXISTS idx_fcm_tokens_user_id ON public.fcm_tokens(user_id);
ALTER TABLE public.fcm_tokens ENABLE ROW LEVEL SECURITY;

-- Policies de sécurité
CREATE POLICY "Users can view their own FCM token" ON public.fcm_tokens FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert their own FCM token" ON public.fcm_tokens FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Users can update their own FCM token" ON public.fcm_tokens FOR UPDATE USING (auth.uid() = user_id);

-- Fonction pour updated_at
CREATE OR REPLACE FUNCTION public.handle_updated_at() RETURNS TRIGGER AS $$
BEGIN 
    NEW.updated_at = NOW(); 
    RETURN NEW; 
END; 
$$ LANGUAGE plpgsql;

-- Trigger automatique
CREATE TRIGGER set_fcm_tokens_updated_at BEFORE UPDATE ON public.fcm_tokens FOR EACH ROW EXECUTE FUNCTION public.handle_updated_at();
```

3. **Cliquez sur "Run"**

## Après la migration

✅ Notifications push en temps réel  
✅ Stockage des données utilisateur  
✅ Interface administrative complète  
✅ Google Maps intégré  

L'application sera entièrement fonctionnelle après cette migration !